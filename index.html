<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>JerseyStem Inventory</title>
  <link rel="manifest" href="manifest.json">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #000000;
      --surface: #161b22;
      --surface-hover: #1c2128;
      --border: #30363d;
      --text: #e6edf3;
      --text-muted: #7d8590;
      --accent: #58a6ff;
      --success: #3fb950;
      --warning: #d29922;
      --danger: #f85149;
      --purple: #a371f7;
    }

    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body { font-family:'Inter',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; min-height:100dvh; overflow-x:hidden; }

    .bg-global{
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }
    .bg-global .grid{
      position:absolute; inset:-2px;
      background:
        radial-gradient(circle at 1px 1px, rgba(255,255,255,0.07) 1px, transparent 1.2px);
      background-size: 26px 26px;
      opacity: 0.55;
      transform: translateZ(0);
    }
    .bg-global .sparkles{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 15% 20%, rgba(88,166,255,0.20), transparent 35%),
        radial-gradient(circle at 80% 30%, rgba(163,113,247,0.18), transparent 40%),
        radial-gradient(circle at 50% 85%, rgba(63,185,80,0.12), transparent 45%);
      filter: blur(2px);
    }
    .bg-global .blob{
      position:absolute;
      width:620px; height:620px;
      border-radius:50%;
      filter: blur(52px);
      opacity:0.35;
      mix-blend-mode: screen;
      animation: floaty 10s ease-in-out infinite;
    }
    .bg-global .blob-1{ left:-260px; top:-220px; background: radial-gradient(circle, rgba(88,166,255,0.85), transparent 60%); }
    .bg-global .blob-2{ right:-300px; top:120px; background: radial-gradient(circle, rgba(163,113,247,0.80), transparent 60%); animation-duration: 12s; }
    .bg-global .blob-3{ left:60px; bottom:-330px; background: radial-gradient(circle, rgba(63,185,80,0.60), transparent 60%); animation-duration: 14s; }
    @keyframes floaty{
      0%,100%{ transform: translate(0,0) scale(1); }
      50%{ transform: translate(18px,-22px) scale(1.04); }
    }

    .app { position:relative; z-index:1; max-width:480px; margin:0 auto; min-height:100vh; min-height:100dvh; display:flex; flex-direction:column; }

    .header { padding:16px 20px 12px; }
    .header-top { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; gap:10px; }
    .header-nav { display:flex; align-items:center; gap:6px; font-size:13px; color:var(--text-muted); margin-bottom:16px; flex-wrap:wrap; }
    .header-nav a { color:var(--text-muted); text-decoration:none; }
    .header-nav a:hover { color:var(--text); }
    .header-nav .sep { color:var(--border); }
    .header-nav .current { color:var(--text); }
    .page-title { font-size:28px; font-weight:700; }
    .role-badge { padding:4px 10px; border-radius:12px; font-size:11px; font-weight:600; text-transform:uppercase; }
    .role-badge.admin { background:rgba(163,113,247,0.2); color:var(--purple); }
    .role-badge.instructor { background:rgba(88,166,255,0.2); color:var(--accent); }

    .search-box { background:rgba(22,27,34,0.84); border:1px solid rgba(255,255,255,0.12); border-radius:10px; padding:12px 16px; display:flex; align-items:center; gap:10px; margin:0 20px 16px; backdrop-filter: blur(12px); }
    .search-box input { background:none; border:none; color:var(--text); font-size:15px; width:100%; outline:none; }
    .search-box input::placeholder { color:var(--text-muted); }

    .screen { display:none; flex:1; flex-direction:column; }
    .screen.active { display:flex; }

    /* Top Airtable button */
    .top-airtable {
      position: fixed;
      top: calc(10px + env(safe-area-inset-top));
      right: calc(10px + env(safe-area-inset-right));
      z-index: 2000;
      display: none;
      width: auto;
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 800;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(22,27,34,0.84);
      color: var(--text);
      cursor: pointer;
      font-family: inherit;
      backdrop-filter: blur(12px);
      line-height: 1;
    }
    .top-airtable:hover {
      background: rgba(28,33,40,0.88);
      border-color: rgba(88,166,255,0.55);
    }
    @media (max-width: 420px) {
      .top-airtable{
        right: auto;
        left: calc(10px + env(safe-area-inset-left));
        padding: 9px 10px;
        font-size: 12px;
        border-radius: 11px;
      }
    }

    #login-screen{
      position:relative;
      width:100vw;
      left:50%;
      transform:translateX(-50%);
      min-height:100vh;
      min-height:100dvh;
    }
    .login-hero { position:relative; flex:1; overflow:hidden; min-height:100vh; min-height:100dvh; }
    .login-container{
      position:relative;
      z-index:2;
      min-height:100vh;
      min-height:100dvh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px;
    }
    .login-card{
      background: rgba(22,27,34,0.84);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 22px;
      padding: 34px 28px;
      width:100%;
      max-width: 520px;
      backdrop-filter: blur(12px);
      box-shadow: 0 24px 90px rgba(0,0,0,0.60);
      position:relative;
      overflow:hidden;
    }
    .login-card:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(circle at 20% 0%, rgba(88,166,255,0.20), transparent 55%),
        radial-gradient(circle at 90% 30%, rgba(163,113,247,0.16), transparent 60%);
      pointer-events:none;
    }

    .brand{
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      gap: 12px;
      margin-bottom: 14px;
      position:relative;
      z-index:1;
    }
    .brand-mark{ display:flex; justify-content:center; align-items:center; margin-bottom: 2px; }
    .brand-logo{
      width: 120px;
      height: auto;
      background: #fff;
      border-radius: 50%;
      padding: 10px;
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.14),
        0 14px 36px rgba(0,0,0,0.55);
    }
    .brand-text h1{ font-size:30px; letter-spacing:-0.7px; margin:0; }
    .brand-text .accent{ color: var(--accent); }
    .brand-subtitle{
      margin: 6px 0 0;
      color: var(--text-muted);
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.2px;
    }

    .form-group { margin-bottom:16px; position:relative; z-index:1; }
    .form-group label { display:block; font-size:13px; color:var(--text-muted); margin-bottom:7px; }
    .field{
      display:flex; align-items:center; gap:10px;
      background: rgba(0,0,0,0.55);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:14px;
      padding: 12px 14px;
      transition: border-color 0.15s ease, transform 0.12s ease;
    }
    .field:focus-within{ border-color: rgba(88,166,255,0.80); transform: translateY(-1px); }
    .field-ic{ width:22px; text-align:center; opacity:0.9; }
    .field input{
      flex:1;
      width: 100%;
      min-width: 0;
      background:none;
      border:none;
      outline:none;
      color:var(--text);
      font-size:16px;
      font-family:inherit;
      color-scheme: dark;
    }
    .field input::placeholder{ color: rgba(125,133,144,0.9); }

    .peek{
      border:none;
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 9px 11px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform 0.12s ease, opacity 0.12s ease;
      font-size: 14px;
    }
    .peek:hover{ transform: translateY(-1px); opacity:0.95; }

    .error-msg { color:var(--danger); font-size:12px; margin-top:8px; display:none; }
    .error-msg.show { display:block; }

    .btn {
      width:100%;
      padding:16px;
      background:var(--accent);
      color:#fff;
      border:none;
      border-radius:14px;
      font-size:16px;
      font-weight:800;
      cursor:pointer;
      font-family:inherit;
      position:relative;
      overflow:hidden;
    }
    .btn:hover { opacity:0.95; }
    .btn:disabled { opacity:0.5; cursor:not-allowed; }
    .btn-glow{
      position:absolute; inset:-2px;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,0.25), transparent 35%),
        radial-gradient(circle at 80% 30%, rgba(255,255,255,0.18), transparent 40%);
      opacity: 0.6;
      pointer-events:none;
    }
    .btn-text{ position:relative; z-index:1; }

    .login-mini{
      margin-top: 14px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      position:relative; z-index:1;
    }
    .mini-pill{
      font-size:12px;
      color: var(--text-muted);
      padding: 7px 11px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.30);
    }

    .confetti{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:3;
    }

    .btn-secondary { background:rgba(22,27,34,0.84); border:1px solid rgba(255,255,255,0.12); color:var(--text); backdrop-filter: blur(12px); }
    .btn-danger { background:var(--danger); }
    .btn-success { background:var(--success); }
    .btn-small { padding:10px 16px; font-size:14px; width:auto; }

    .menu-wrap{ padding: 20px; display:flex; flex:1; }
    .menu-card{
      width:100%;
      background: rgba(22,27,34,0.84);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px;
      padding: 18px;
      margin: auto 0;
      backdrop-filter: blur(12px);
      box-shadow: 0 24px 90px rgba(0,0,0,0.40);
    }
    .menu-title{ font-size:22px; font-weight:800; margin-bottom:6px; }
    .menu-sub{ color: var(--text-muted); font-size:13px; margin-bottom:14px; }
    .menu-actions{ display:grid; gap:12px; }
    .menu-actions .btn{ width:100%; }

    .list-container { flex:1; overflow-y:auto; padding:0 20px; }
    .school-card { background:rgba(22,27,34,0.84); border:1px solid rgba(255,255,255,0.12); border-radius:12px; padding:16px; margin-bottom:10px; cursor:pointer; transition:all 0.15s; backdrop-filter: blur(12px); }
    .school-card:hover { background:rgba(28,33,40,0.88); border-color:rgba(88,166,255,0.55); }
    .school-header { display:flex; justify-content:space-between; align-items:flex-start; }
    .school-info h3 { font-size:16px; font-weight:600; margin-bottom:4px; }
    .school-meta { display:flex; align-items:center; gap:8px; font-size:13px; color:var(--text-muted); margin-bottom:8px; }
    .school-deadlines { font-size:11px; color:var(--text-muted); display:flex; gap:12px; flex-wrap:wrap; }
    .school-deadlines span { display:flex; align-items:center; gap:4px; }
    .deadline-dot { width:6px; height:6px; border-radius:50%; }
    .deadline-dot.active { background:var(--success); }
    .deadline-dot.expired { background:var(--danger); }
    .deadline-dot.pending { background:var(--warning); }
    .status-dot { width:8px; height:8px; border-radius:50%; }
    .status-dot.pending { background:var(--warning); }
    .status-dot.complete { background:var(--success); }
    .status-dot.issues { background:var(--danger); }
    .chevron { color:var(--text-muted); font-size:20px; }

    .footer { padding:16px 20px; border-top:1px solid rgba(255,255,255,0.10); background: rgba(0,0,0,0.15); backdrop-filter: blur(12px); }
    .logout-btn { background:none; border:none; color:var(--text-muted); font-size:14px; cursor:pointer; display:flex; align-items:center; gap:8px; padding:12px 0; width:100%; }
    .logout-btn:hover { color:var(--text); }

    .filters { display:flex; gap:8px; padding:0 20px; margin-bottom:16px; overflow-x:auto; }
    .filter-btn { padding:8px 14px; background:rgba(22,27,34,0.84); border:1px solid rgba(255,255,255,0.12); border-radius:20px; font-size:13px; color:var(--text-muted); cursor:pointer; white-space:nowrap; display:flex; align-items:center; gap:6px; font-family:inherit; backdrop-filter: blur(12px); }
    .filter-btn.active { background:var(--accent); border-color:var(--accent); color:#fff; }
    .filter-btn .count { background:rgba(255,255,255,0.2); padding:2px 7px; border-radius:10px; font-size:11px; }

    .kit-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; padding:0 20px; }
    .kit-card { background:rgba(22,27,34,0.84); border:1px solid rgba(255,255,255,0.12); border-radius:12px; padding:16px; cursor:pointer; transition:all 0.15s; backdrop-filter: blur(12px); }
    .kit-card:hover { background:rgba(28,33,40,0.88); border-color:rgba(88,166,255,0.55); }
    .kit-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px; }
    .kit-name { font-size:16px; font-weight:600; }
    .kit-menu { background:none; border:none; color:var(--text-muted); cursor:pointer; padding:4px; font-size:16px; }

    .kit-status { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:6px; font-size:12px; font-weight:500; }
    .kit-status.pending { background:rgba(210,153,34,0.15); color:var(--warning); }
    .kit-status.complete { background:rgba(63,185,80,0.15); color:var(--success); }
    .kit-status.issues { background:rgba(248,81,73,0.15); color:var(--danger); }

    .inventory-header { padding:0 20px; margin-bottom:16px; }
    .inventory-title-row { display:flex; justify-content:space-between; align-items:center; }
    .inventory-title { font-size:20px; font-weight:700; }
    .save-status { display:flex; align-items:center; gap:6px; font-size:13px; color:var(--text-muted); }
    .save-status.unsaved { color:var(--warning); }
    .save-status.saved { color:var(--success); }
    .save-status.locked { color:var(--danger); }
    .save-dot { width:8px; height:8px; border-radius:50%; background:currentColor; }
    .deadline-info { font-size:12px; color:var(--text-muted); margin-top:6px; padding:8px 12px; background:rgba(22,27,34,0.84); border-radius:8px; display:flex; align-items:center; gap:8px; border: 1px solid rgba(255,255,255,0.10); backdrop-filter: blur(12px); }

    .semester-tabs { display:flex; margin:0 20px 16px; background:rgba(22,27,34,0.84); border-radius:10px; padding:4px; border:1px solid rgba(255,255,255,0.10); backdrop-filter: blur(12px); }
    .semester-tab { flex:1; padding:10px; text-align:center; font-size:13px; font-weight:500; color:var(--text-muted); cursor:pointer; border-radius:8px; border:none; background:none; font-family:inherit; position:relative; }
    .semester-tab.active { background:var(--accent); color:#fff; }
    .semester-tab.locked { opacity:0.6; }
    .semester-tab .lock-icon { margin-left:4px; }

    .categories {
      flex: 1;
      overflow-y: auto;
      padding: 0 20px 160px; /* extra space for footer */
    }

    .category { margin-bottom:8px; }
    .category-header { display:flex; justify-content:space-between; align-items:center; padding:12px 0; cursor:pointer; border-bottom:1px solid rgba(255,255,255,0.10); }
    .category-name { font-size:14px; font-weight:600; color:var(--text-muted); }
    .category-chevron {
      color: var(--text-muted);
      transition: transform 0.2s ease;
      font-size: 14px;
    }

    .category.collapsed .category-chevron {
      transform: rotate(-90deg);
    }

    .category.collapsed .category-items {
      display: none;
    }

    .category-header {
      cursor: pointer;
    }
    .category-header:hover {
      background: rgba(255,255,255,0.04);
      border-radius: 8px;
    }



    .part-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 0;
      gap: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }



    .inventory-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(10, 14, 18, 0.85);
      border-top: 1px solid rgba(255,255,255,0.12);
      padding: 14px 16px calc(14px + env(safe-area-inset-bottom));
      display: flex;
      gap: 10px;
      backdrop-filter: blur(16px);
    }

    .inventory-footer .btn {
      flex: 1;
      padding: 14px;
      font-size: 15px;
      border-radius: 12px;
    }

    @media(min-width:480px) { .inventory-footer { left:50%; transform:translateX(-50%); max-width:480px; } }

    .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.75); display:none; align-items:center; justify-content:center; z-index:100; padding:20px; }
    .modal-overlay.active { display:flex; }
    .modal { background:rgba(22,27,34,0.92); border:1px solid rgba(255,255,255,0.12); border-radius:16px; width:100%; max-width:400px; padding:24px; max-height:90vh; overflow-y:auto; backdrop-filter: blur(12px); }
    .modal h2 { font-size:18px; margin-bottom:16px; }
    .modal-actions { display:flex; gap:10px; margin-top:20px; }
    .modal-actions .btn { flex:1; padding:12px; }

    .empty-state { text-align:center; padding:60px 20px; color:var(--text-muted); }
    .empty-state p { margin-bottom:16px; }
    .part-icon {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      background: rgba(255,255,255,0.05);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      flex-shrink: 0;
    }

    .part-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .part-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .part-details {
      display: flex;
      flex-direction: column;
    }

    .part-name {
      font-size: 15px;
      font-weight: 600;
    }

    .part-expected {
      font-size: 12px;
      color: var(--text-muted);
    }

    .part-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .counter {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(255,255,255,0.05);
      padding: 4px 6px;
      border-radius: 8px;
    }

    .counter-btn {
      width: 26px;
      height: 26px;
      border: none;
      border-radius: 6px;
      background: rgba(255,255,255,0.08);
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    .counter-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .counter-value {
      width: 36px;
      text-align: center;
      background: transparent;
      border: none;
      color: white;
      font-size: 15px;
    }

    .part-badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: 600;
    }

    .part-badge.ok {
      background: rgba(63,185,80,0.15);
      color: var(--success);
    }

    .part-badge.missing {
      background: rgba(248,81,73,0.15);
      color: var(--danger);
    }

    .part-badge.empty {
      background: rgba(255,255,255,0.08);
      color: var(--text-muted);
    }



  </style>
</head>

<body>
  <div class="bg-global" aria-hidden="true">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
    <div class="grid"></div>
    <div class="sparkles"></div>
  </div>

  <button id="airtable-top-btn" class="top-airtable" onclick="openAirtable()">Airtable</button>

  <div class="app">

    <!-- Login Screen -->
    <div id="login-screen" class="screen active">
      <div class="login-hero">
        <div class="login-container">
          <div class="login-card">

            <div class="brand">
              <div class="brand-mark">
                <img src="assets/logo.png" alt="JerseySTEM logo" class="brand-logo" />
              </div>

              <div class="brand-text">
                <h1>Jersey<span class="accent">Stem</span></h1>
                <p class="brand-subtitle">Inventory Management</p>
              </div>
            </div>

            <form id="login-form">
              <div class="form-group">
                <label>Email</label>
                <div class="field">
                  <span class="field-ic">üìß</span>
                  <input type="email" id="email-input" placeholder="name@mystemclub.org" required autocomplete="username">
                </div>
                <div class="error-msg" id="email-error">Use an @mystemclub.org email</div>
              </div>

              <div class="form-group">
                <label>Password</label>
                <div class="field">
                  <span class="field-ic">üîí</span>
                  <input type="password" id="password-input" placeholder="Enter password" required autocomplete="current-password">
                  <button class="peek" type="button" onclick="togglePw()" aria-label="Show password">üëÅÔ∏è</button>
                </div>
                <div class="error-msg" id="password-error">Incorrect password</div>
              </div>

              <button type="submit" class="btn" id="login-btn">
                <span class="btn-glow"></span>
                <span class="btn-text">Sign In to Inventory üîê</span>
              </button>

              <div class="login-mini">
                <span class="mini-pill">‚öôÔ∏è Track kits</span>
                <span class="mini-pill">üì¶ Inventory</span>
                <span class="mini-pill">üè´ School-ready</span>
              </div>
            </form>

          </div>
        </div>

        <canvas id="confetti" class="confetti" aria-hidden="true"></canvas>
      </div>
    </div>

    <!-- Menu Screen -->
    <div id="menu-screen" class="screen">
      <div class="header">
        <div class="header-top">
          <h1 class="page-title">Welcome</h1>
          <button class="btn btn-small btn-secondary" onclick="logout()" style="width:auto;">Log Out</button>
        </div>
      </div>

      <div class="menu-wrap">
        <div class="menu-card">
          <div class="menu-title">Hi, <span id="menu-user-display"></span> üëã</div>
          <div class="menu-sub">Choose where you want to go.</div>

          <div class="menu-actions">
            <button class="btn" onclick="showScreen('school-screen')">Inventory</button>
            <button class="btn btn-secondary" onclick="openAirtable()">Airtable</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Schools Screen -->
    <div id="school-screen" class="screen">
      <div class="header">
        <div class="header-top">
          <h1 class="page-title">Schools</h1>
          <span class="role-badge" id="role-badge-schools">Admin</span>
        </div>
      </div>

      <div class="search-box">
        <span>üîç</span>
        <input type="text" id="school-search" placeholder="Search schools..." oninput="filterSchools()">
      </div>

      <div class="list-container" id="school-list"></div>

      <div id="school-empty" class="empty-state" style="display:none;">
        <p>No schools yet</p>
        <!-- admin-only visibility is handled by app.js updateRoleBadge(); keep hidden by default -->
        <button class="btn" id="add-school-empty-btn" style="width:auto;padding:12px 24px; display:none;" onclick="openModal('add-school-modal')">
          + Add School
        </button>
      </div>

      <div class="footer">
        <!-- admin-only visibility is handled by app.js updateRoleBadge(); keep hidden by default -->
        <button class="btn" id="add-school-btn" style="margin-bottom:12px; display:none;" onclick="openModal('add-school-modal')">+ Add School</button>

        <button class="logout-btn" onclick="logout()">
          <span>‚Üê</span> Log Out (<span id="user-display"></span>)
        </button>
      </div>
    </div>

    <!-- Kits Screen -->
    <div id="kit-screen" class="screen">
      <div class="header">
        <div class="header-nav">
          <a href="#" onclick="showScreen('school-screen');return false;">Schools</a>
          <span class="sep">‚Ä∫</span>
          <span class="current" id="nav-school-name">School</span>
        </div>
        <div class="header-top">
          <h1 class="page-title">Kits</h1>
          <button class="btn btn-small" id="school-settings-btn" onclick="openSchoolSettings()" style="display:none;">‚öôÔ∏è Settings</button>
        </div>
      </div>
      <div id="kit-deadline-alert"></div>
      <div class="filters" id="kit-filters">
        <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">All</button>
        <button class="filter-btn" data-filter="pending" onclick="setFilter('pending')">Pending <span class="count" id="pending-count">0</span></button>
        <button class="filter-btn" data-filter="issues" onclick="setFilter('issues')">Issues <span class="count" id="issues-count">0</span></button>
        <button class="filter-btn" data-filter="complete" onclick="setFilter('complete')">Complete</button>
      </div>
      <div class="list-container">
        <div class="kit-grid" id="kit-grid"></div>
        <div id="kit-empty" class="empty-state" style="display:none;">
          <p>No kits found</p>
        </div>
      </div>
      <div class="footer">
        <button class="btn" id="add-kit-btn" style="margin-bottom:12px;" onclick="openModal('add-kit-modal')">+ Add Kit</button>
        <button class="logout-btn" onclick="showScreen('school-screen')">
          <span>‚Üê</span> Back to Schools
        </button>
      </div>
    </div>

    <!-- Inventory Screen -->
    <div id="inventory-screen" class="screen">
      <div class="header">
        <div class="header-nav">
          <a href="#" onclick="showScreen('school-screen');return false;">Schools</a>
          <span class="sep">‚Ä∫</span>
          <a href="#" onclick="showScreen('kit-screen');return false;" id="nav-school-name2">School</a>
          <span class="sep">‚Ä∫</span>
          <span class="current" id="nav-kit-name">Kit</span>
        </div>
      </div>
      <div class="inventory-header">
        <div class="inventory-title-row">
          <h1 class="inventory-title" id="inventory-title">Kit Inventory</h1>
          <div class="save-status" id="save-status">
            <span class="save-dot"></span>
            <span id="save-text">Saved</span>
          </div>
        </div>
        <div class="deadline-info" id="deadline-info" style="display:none;"></div>
      </div>
      <div class="semester-tabs">
        <button class="semester-tab active" data-sem="start" onclick="setSemester('start')">
          Start of Semester<span class="lock-icon" id="start-lock"></span>
        </button>
        <button class="semester-tab" data-sem="end" onclick="setSemester('end')">
          End of Semester<span class="lock-icon" id="end-lock"></span>
        </button>
      </div>
      <div class="categories" id="categories"></div>
      <div class="inventory-footer" id="inventory-footer">
        <button class="btn btn-secondary" onclick="goBack()">‚Üê Back</button>
        <button class="btn btn-secondary" id="clear-btn" onclick="confirmClear()">Clear</button>
        <button class="btn btn-success" id="save-btn" onclick="saveChanges()">Save</button>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div class="modal-overlay" id="add-school-modal">
    <div class="modal">
      <h2>Add School</h2>
      <div class="form-group">
        <label>School Name</label>
        <input type="text" id="new-school-name" placeholder="e.g. Lincoln Elementary">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Start Deadline</label>
          <input type="date" id="new-school-start-deadline">
        </div>
        <div class="form-group">
          <label>End Deadline</label>
          <input type="date" id="new-school-end-deadline">
        </div>
      </div>
      <p class="help-text">Instructors cannot edit inventory after these dates.</p>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeModal('add-school-modal')">Cancel</button>
        <button class="btn" onclick="addSchool()">Add School</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="add-kit-modal">
    <div class="modal">
      <h2>Add Kit</h2>
      <div class="form-group">
        <label>Kit Name (optional)</label>
        <input type="text" id="new-kit-name" placeholder="e.g. Blue Table, Group A">
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeModal('add-kit-modal')">Cancel</button>
        <button class="btn" onclick="addKit()">Add Kit</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="confirm-clear-modal">
    <div class="modal">
      <h2>Clear Inventory?</h2>
      <p style="color:var(--text-muted);margin-bottom:8px;">This will reset all values for the current semester to empty. This cannot be undone.</p>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeModal('confirm-clear-modal')">Cancel</button>
        <button class="btn btn-danger" onclick="clearInventory()">Yes, Clear All</button>
      </div>
    </div>
  </div>

  <script>
    function togglePw(){
      const inp = document.getElementById("password-input");
      const btn = document.querySelector(".peek");
      if (!inp) return;
      const isPw = inp.type === "password";
      inp.type = isPw ? "text" : "password";
      if (btn) btn.textContent = isPw ? "üôà" : "üëÅÔ∏è";
    }

  function setAirtableTopVisible(){
      const btn = document.getElementById("airtable-top-btn");
      const login = document.getElementById("login-screen");
      const menu = document.getElementById("menu-screen");
      if (!btn || !login) return;

      const shouldHide = login.classList.contains("active") || (menu && menu.classList.contains("active"));
      btn.style.display = shouldHide ? "none" : "inline-flex";
    }

    document.addEventListener("DOMContentLoaded", () => {
      setAirtableTopVisible();

      // Wrap showScreen so the airtable button updates automatically
      const originalShowScreen = window.showScreen;
      if (typeof originalShowScreen === "function") {
        window.showScreen = function(id){
          originalShowScreen(id);
          setAirtableTopVisible();
        };
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="app.js"></script>
</body>
</html>
